##########################
#
# ARCHAEOLOGY SITE EVENTS
#
##########################

namespace = AAA_arcsite

####################################
# "Lartia's Glory" by Metallichydra
####################################

# computer terminal | from = arcsite
fleet_event = {
	id = AAA_arcsite.1
	title = AAA_arcsite.1.name
	desc = AAA_arcsite.1.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_laboratory_sound

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# take the computer apart for a substantial alloy reward
	option = {
		name = TAKE_IT_APART
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
	}
	# extract any files on the harddrive for a science reward, as well as a tech related to computers
	option = {
		name = DISMANTLE_CAREFUL
		trigger = {
			owner = {
				NOT = { has_technology = tech_administrative_ai }
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_research_option = tech_administrative_ai
			add_tech_progress = {
				tech = tech_administrative_ai
				progress = 0.3
			}
		}
	}
	# scavengers option
	option = {
		name = DO_BOTH
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_scavengers
					has_valid_civic = civic_corporate_scavengers
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Words of power | from = arcsite
fleet_event = {
	id = AAA_arcsite.2
	title = AAA_arcsite.2.name
	desc = AAA_arcsite.2.desc
	picture = GFX_evt_intelligence_report
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		# from = { set_site_progress_locked = no }
		}
		from = { set_site_progress_locked = no }
	}
	# memorialist # replace modifier with custom
	option = {
		name = PUBLISH_LOG
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_memorialist
					has_valid_civic = civic_scavengers
				}
			}
		}
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 100
				}
			}
		}
		owner = {
			add_resource = { energy = -100 }
				add_modifier = {
					modifier = spurred_by_the_past
					years = 10
				}
			}
		from = { set_site_progress_locked = no }
	}
}


# Log Deciphered | from = arcsite
fleet_event = {
	id = AAA_arcsite.3
	title = AAA_arcsite.3.name
	desc = AAA_arcsite.3.desc
	picture = GFX_evt_intelligence_report
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Try to figure out who the aliens where
	option = {
		name = FIND_CREATORS
		from = {
			set_archaeology_flag = lanx
		}
	}

	# Try to figure out who their enemy where
	option = {
		name = FIND_ENEMY
		from = {
			set_archaeology_flag = plexi
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# fate (branching event)
fleet_event = {
	id = AAA_arcsite.4
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			1 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = plexi
						}
					}
				}
				fleet_event = { id = AAA_arcsite.5 } # Lanx
			}
			1 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = lanx
						}
					}
				}
				fleet_event = { id = AAA_arcsite.6 } # plexi
			}
		}
	}
}
# the lanx | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.5
	title = AAA_arcsite.5.name
	desc = AAA_arcsite.5.desc
	picture = GFX_evt_ground_combat
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		fromfrom = {
			set_archaeology_flag = lanx
		}
	}

	option = {
		name = A_TRAGIC_TALE
		fromfrom = { set_site_progress_locked = no }
	}
}

# the plexi | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.6
	title = AAA_arcsite.6.name
	desc = AAA_arcsite.6.desc
	picture = GFX_evt_molten
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		fromfrom = {
			set_archaeology_flag = plexi
		}
	}

	option = {
		name = A_TRAGIC_TALE
		fromfrom = { set_site_progress_locked = no }
	}
}

# Fate of the ship
fleet_event = {
	id = AAA_arcsite.7
	title = AAA_arcsite.7.name
	desc = AAA_arcsite.7.desc
	picture = GFX_evt_exploding_ship
	location = from
	show_sound = event_dig_site
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Were the dead fall, new life blooms
	option = {
		name = IT_WAS_NOT_FOR_NOTHING
		owner = {
			add_modifier = {
				modifier = ice_trauma_insights_colony
				years = 20
			}
		}

	}
	# A reason as to why space is scary
	option = {
		name = A_LESSON_ON_THE_QRUELTY_OF_SPACE
		owner = {
			add_modifier = {
				modifier = ice_trauma_insights_colony
				years = 20
			}
		}
	}
	# A silly tale of weaklings
	option = {
		name = A_SILLY_TALE
		trigger = {
			from = {
				NOT = {
					has_archaeology_flag = lanx
				}
			}
			owner = {
				OR = {
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_militarist
				}
			}
		}
		owner = {
			add_modifier = {
				modifier = ice_trauma_insights_colony
				years = 20
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Finale | from = arcsite
fleet_event = {
	id = AAA_arcsite.8
	title = AAA_arcsite.8.name
	desc = AAA_arcsite.8.desc
	picture = GFX_evt_partition
	location = from
	show_sound = event_dig_site
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Lartia
	option = {
		name = CHOOSE_LARTIA
		trigger = {
			from = {
				OR = {
					has_archaeology_flag = lanx
				}
			}
		}
		owner = {
			hidden_effect = {
				country_event = { id = AAA_arcsite.9 } #Spawns Lartia
			}
		}

	}
	# plexi
	option = {
		name = CHOOSE_PLEXI_HOMEWORLD
		trigger = {
			from = {
				OR = {
					has_archaeology_flag = plexi
				}
			}
		}
		owner = {
			hidden_effect = {
				country_event = { id = AAA_arcsite.10 } #Spawns Plexi Homeworld
			}
		}

	}
	# None
	option = {
		name = CHOOSE_NONE
		trigger = {
			owner = {
				NOR = {
					has_valid_civic = civic_scavengers
					has_valid_civic = civic_corporate_scavengers
				}
			}
		}
		owner = {
			add_research_option = tech_mass_drivers_3
			add_tech_progress = {
				tech = tech_mass_drivers_3
				progress = 0.6
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Lartia System Discovered (HIDDEN)
country_event = {
	id = AAA_arcsite.9
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = lartia_discovered
		set_country_flag = lartia_system
		random_system_within_border = {
			save_event_target_as = lartia_spawn_system
		}
		event_target:lartia_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "lartia_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = AAA_arcsite.12 days = 2 }
	}
}

# Plexi Homeworld System Discovered (HIDDEN)
country_event = {
	id = AAA_arcsite.10
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = plexi_discovered
		set_country_flag = plexi_system
		random_system_within_border = {
			save_event_target_as = plexi_spawn_system
		}
		event_target:plexi_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "plexi_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = AAA_arcsite.13 days = 2 }
	}
}

# Destination System Discovered (HIDDEN)
#country_event = {
#	id = AAA_arcsite.11
#	hide_window = yes
#
#	fire_only_once = yes
#
#	is_triggered_only = yes
#
#	immediate = {
#		set_global_flag = destination_discovered
#		set_country_flag = destination_system
#		random_system_within_border = {
#			save_event_target_as = destination_spawn_system
#		}
#		event_target:destination_spawn_system = {
#			spawn_system = {
#				min_distance = 10
#				max_distance = 30
#				max_jumps = 0
#				initializer = "destination_system"
#			}
#			if = {
#				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
#				add_hyperlane = {
#					from = this
#					to = last_created_system
#				}
#			}
#			else = {
#				add_extra_hyperlane_to_spawned_system_effect = yes
#			}
#		}
#		country_event = { id = AAA_arcsite.14 days = 2 }
#	}
#}

# Lartia System Discovered
country_event = {
	id = AAA_arcsite.12
	title = "AAA_arcsite.12.name"
	desc = "AAA_arcsite.12.desc"
	picture = GFX_evt_federation_fleet
	location = event_target:lartia

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = lartia }
			save_event_target_as = lartia
			root = { set_visited = prev }
			random_system_planet = {
				limit = { has_planet_flag = lartia_homeworld }
				save_event_target_as = lartia_homeworld
			}
		}
		observer_event = { id = observer.59 }
	}

	option = {
		name = "precursor.100.a"
	}
}

# Plexi System Discovered
country_event = {
	id = AAA_arcsite.13
	title = "AAA_arcsite.13.name"
	desc = "AAA_arcsite.13.desc"
	picture = GFX_evt_federation_fleet
	location = event_target:plexi

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = plexi }
			save_event_target_as = plexi
			root = { set_visited = prev }
			random_system_planet = {
				limit = { has_planet_flag = plexi_homeworld }
				save_event_target_as = plexi_homeworld
			}
		}
		observer_event = { id = observer.59 }
	}

	option = {
		name = "precursor.100.a"
	}
}

# Destination System Discovered
# country_event = {
#	id = AAA_arcsite.14
#	title = "AAA_arcsite.14.name"
#	desc = "AAA_arcsite.14.desc"
#	picture = GFX_evt_federation_fleet
#	location = event_target:destination
#
#	is_triggered_only = yes
#
#	immediate = {
#		random_system = {
#			limit = { has_star_flag = destination }
#			save_event_target_as = destination
#			root = { set_visited = prev }
#			random_system_planet = {
#				limit = { has_planet_flag = destination_homeworld }
#				save_event_target_as = destination_homeworld
#			}
#		}
#		observer_event = { id = observer.59 }
#	}
#
#	option = {
#		name = "precursor.100.a"
#	}
#}

####################################
# "Ruins of Lartia" by Metallichydra
####################################

# the central spire | from = arcsite
fleet_event = {
	id = AAA_arcsite.15
	title = AAA_arcsite.15.name
	desc = AAA_arcsite.15.desc
	picture = GFX_evt_relic_world_building
	location = from
	show_sound = event_wind_ruins

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# It must hold untold riches
	option = {
		name = MUST_HOLD_UNTOLD_RICHES
	}

	# how could they fall?
	option = {
		name = JUST_THINK_OF_POWER
	}

	# we must uncover the history
	option = {
		name = WE_MUST_UNCOVER_ITS_HISTORY
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# the heart of an empire
fleet_event = {
	id = AAA_arcsite.16
	title = AAA_arcsite.16.name
	desc = AAA_arcsite.16.desc
	picture = GFX_evt_relic_world_building
	location = from
	show_sound = event_wind_ruins
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# A lot of work lies ahead of us
	option = {
		name = WORK_AHEAD_LARTIA
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# the vault
fleet_event = {
	id = AAA_arcsite.17
	title = AAA_arcsite.17.name
	desc = AAA_arcsite.17.desc
	picture = GFX_evt_discovered_hidden_door
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# cut it open
	option = {
		name = CUT_IT_OPEN_LARTIA
		from = {
			set_archaeology_flag = lartia_cutter
		}
	}

	# use explosives
	option = {
		name = USE_EXPLOSIVES_LARTIA
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = volatile_motes
					value >= 1
				}
			}
		}
		owner = {
			add_resource = { volatile_motes = -1 }
		}
		from = {
			set_archaeology_flag = lartia_explosives
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

fleet_event = {
	id = AAA_arcsite.18
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			1 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = lartia_explosives
						}
					}
				}
				fleet_event = { id = AAA_arcsite.19 } # cutter
			}
			1 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = lartia_cutter
						}
					}
				}
				fleet_event = { id = AAA_arcsite.20 } # explosives
			}
		}
	}
}

# cutter | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.19
	title = AAA_arcsite.19.name
	desc = AAA_arcsite.19.desc
	picture = GFX_evt_excavation_team
	location = from
	show_sound = event_construction
	archaeology = yes

	is_triggered_only = yes

	# at least some good came of it
	option = {
		name = OK
		fromfrom = { set_site_progress_locked = no }
	}
}

# explosives | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.20
	title = AAA_arcsite.20.name
	desc = AAA_arcsite.20.desc
	picture = GFX_evt_excavation_team
	location = from
	show_sound = event_super_explosion
	archaeology = yes

	is_triggered_only = yes

	# at least some good came of it
	option = {
		name = OK
		fromfrom = { set_site_progress_locked = no }
	}
}

fleet_event = {
	id = AAA_arcsite.21
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			1 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = lartia_explosives
						}
					}
				}
				fleet_event = { id = AAA_arcsite.22 } # cutter
			}
			1 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = lartia_cutter
						}
					}
				}
				fleet_event = { id = AAA_arcsite.23 } # explosives
			}
		}
	}
}

# cutter | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.22
	title = AAA_arcsite.22.name
	desc = AAA_arcsite.22.desc
	picture = GFX_evt_excavation_team
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	# at least some good came of it
	option = {
		name = OK
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = A_STONE_LARTIA
		fromfrom = { set_site_progress_locked = no }
	}
}

# explosives | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.23
	title = AAA_arcsite.23.name
	desc = AAA_arcsite.23.desc
	picture = GFX_evt_excavation_team
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	# at least some good came of it
	option = {
		name = OK
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = A_STONE_LARTIA
		fromfrom = { set_site_progress_locked = no }
	}
}

# The Erztarta | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.24
	title = AAA_arcsite.24.name
	desc = AAA_arcsite.24.desc
	picture = GFX_evt_planet_beam
	location = from
	show_sound = event_finding_loot
	archaeology = yes

	is_triggered_only = yes

	# at least some good came of it
	#option = {
	#	name = OK
	#	fromfrom = { set_site_progress_locked = no }
	#	owner = {
	#		add_relic = r_eztarta
	#		set_country_flag = lartia_found
	#	}
	#}
	option = {
		name = "ancrel.2024.a"
		from = { set_site_progress_locked = no }
		owner = {
			if = {
				limit = { has_ancrel = yes }
				add_relic = r_eztarta
				large_artifact_reward = yes
			}
			set_country_flag = lartia_found
			add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 9999
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			add_monthly_resource_mult = {
				resource = energy
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
			if = {
				limit = { has_ancrel = yes }
				custom_tooltip = lartian_artifact_research_unlocked
			}
		}
	}

	after = {
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

####################################
# "crashed ship" by Metallichydra
####################################

# computer terminal | from = arcsite
fleet_event = {
	id = AAA_arcsite.25
	title = AAA_arcsite.25.name
	desc = AAA_arcsite.25.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_ship_bridge

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# take the computer apart for a substantial alloy reward
	option = {
		name = TAKE_IT_APART
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
	}
	# extract any files on the harddrive for a science reward, as well as a tech related to computers
	option = {
		# get next tier of AI
		name = EXTRACT_FILES
		owner = {
			if = {
				limit = {
					has_technology = tech_sapient_ai
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_self_aware_logic
					NOT = { has_ethic = ethic_gestalt_consciousness }
				}
				add_research_option = tech_sapient_ai
				add_tech_progress = {
					tech = tech_sapient_ai
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_administrative_ai
					NOT = { has_ethic = ethic_gestalt_consciousness }
				}
				add_research_option = tech_self_aware_logic
				add_tech_progress = {
					tech = tech_self_aware_logic
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_administrative_ai
				add_tech_progress = {
					tech = tech_administrative_ai
					progress = 0.5
				}
			}
		}
	}
	# scavengers option
	option = {
		name = DO_BOTH
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_scavengers
					has_valid_civic = civic_corporate_scavengers
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
		owner = {
			if = {
				limit = {
					has_technology = tech_sapient_ai
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_self_aware_logic
				}
				add_research_option = tech_sapient_ai
				add_tech_progress = {
					tech = tech_sapient_ai
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_administrative_ai
				}
				add_research_option = tech_self_aware_logic
				add_tech_progress = {
					tech = tech_self_aware_logic
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_administrative_ai
				add_tech_progress = {
					tech = tech_administrative_ai
					progress = 0.5
				}
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# ship reactor | from = arcsite
fleet_event = {
	id = AAA_arcsite.26
	title = AAA_arcsite.26.name
	desc = AAA_arcsite.26.desc
	picture = GFX_evt_physics_research
	location = from
	show_sound = event_default

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# dismantle the ships reactor
	option = {
		name = DISMANTLE_REACTOR
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
	}
	# study its construction
	option = {
		# get next tier of reactor
		name = STUDY_REACTOR
		owner = {
			if = {
				limit = {
					has_technology = tech_zero_point_power
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_antimatter_power
				}
				add_research_option = tech_zero_point_power
				add_tech_progress = {
					tech = tech_zero_point_power
					progress = 0.2
				}
			}
			else_if = {
				limit = {
					has_technology = tech_cold_fusion_power
				}
				add_research_option = tech_antimatter_power
				add_tech_progress = {
					tech = tech_antimatter_power
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_fusion_power
				}
				add_research_option = tech_cold_fusion_power
				add_tech_progress = {
					tech = tech_cold_fusion_power
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_fusion_power
				add_tech_progress = {
					tech = tech_fusion_power
					progress = 0.5
				}
			}
		}
	}
	# scavengers option
	option = {
		name = DO_BOTH
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_scavengers
					has_valid_civic = civic_corporate_scavengers
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
		owner = {
			if = {
				limit = {
					has_technology = tech_zero_point_power
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_antimatter_power
				}
				add_research_option = tech_zero_point_power
				add_tech_progress = {
					tech = tech_zero_point_power
					progress = 0.2
				}
			}
			else_if = {
				limit = {
					has_technology = tech_cold_fusion_power
				}
				add_research_option = tech_antimatter_power
				add_tech_progress = {
					tech = tech_antimatter_power
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_fusion_power
				}
				add_research_option = tech_cold_fusion_power
				add_tech_progress = {
					tech = tech_cold_fusion_power
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_fusion_power
				add_tech_progress = {
					tech = tech_fusion_power
					progress = 0.5
				}
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# fate (branching event)
fleet_event = {
	id = AAA_arcsite.27
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			1 = {
				modifier = {
					factor = 0
					owner = {
						OR = {
							has_ethic = ethic_gestalt_consciousness
						}
					}
				}
				fleet_event = { id = AAA_arcsite.28 } # Consumer Goods
			}
			1 = {
				modifier = {
					factor = 2
					owner = {
						OR = {
							has_ethic = ethic_fanatic_materialist
							has_ethic = ethic_materialist
						}
					}
				}
				fleet_event = { id = AAA_arcsite.29 } # research
			}
			1 = {
				modifier = {
					factor = 2
					owner = {
						OR = {
							has_ethic = ethic_fanatic_militarist
							has_ethic = ethic_militarist
						}
					}
				}
				fleet_event = { id = AAA_arcsite.30 } # alloys
			}
			1 = {
				fleet_event = { id = AAA_arcsite.31 } # energy credits
			}
			1 = {
				modifier = {
					factor = 0
					owner = {
						OR = {
							has_valid_civic = civic_catalytic_processing
							has_valid_civic = civic_hive_catalytic_processing
							has_valid_civic = civic_machine_catalytic_processing
							has_valid_civic = civic_corporate_catalytic_processing
						}
					}
				}
				fleet_event = { id = AAA_arcsite.32 } # minerals
			}
		}
	}
}

# consumer goods cargo | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.28
	title = AAA_arcsite.28.name
	desc = AAA_arcsite.28.desc
	picture = GFX_evt_ship_offloading_cargo
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		owner = {
			add_resource = { consumer_goods = 400 }
		}
		fromfrom = { set_site_progress_locked = no }
	}
}


# research cargo | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.29
	title = AAA_arcsite.29.name
	desc = AAA_arcsite.29.desc
	picture = GFX_evt_ship_offloading_cargo
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		fromfrom = { set_site_progress_locked = no }
	}
}

# alloys cargo | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.30
	title = AAA_arcsite.30.name
	desc = AAA_arcsite.30.desc
	picture = GFX_evt_ship_offloading_cargo
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		owner = {
			add_resource = { alloys = 200 }
		}
		fromfrom = { set_site_progress_locked = no }
	}
}

# energy credits cargo | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.31
	title = AAA_arcsite.31.name
	desc = AAA_arcsite.31.desc
	picture = GFX_evt_ship_offloading_cargo
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		owner = {
			add_resource = { energy = 1000 }
		}
		fromfrom = { set_site_progress_locked = no }
	}
}

# minerals cargo | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.32
	title = AAA_arcsite.32.name
	desc = AAA_arcsite.32.desc
	picture = GFX_evt_ship_offloading_cargo
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		owner = {
			add_resource = { minerals = 600 }
		}
		fromfrom = { set_site_progress_locked = no }
	}
}

# regenerating hull | from = arcsite
fleet_event = {
	id = AAA_arcsite.33
	title = AAA_arcsite.33.name
	desc = AAA_arcsite.33.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_mystic_reveal

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# setup a dedicated harvest zone
	option = {
		name = AAA_arcsite.33.a
		from.planet = {
			add_deposit = d_AAA_crashed_ship_alloy_farm_zone
			last_added_deposit = {
				set_deposit_flag = keep_deposit_on_terraform
			}
		}
	}
	# do science on it
	option = {
		name = AAA_arcsite.33.b
		trigger = {
			owner = {
				NOT = { has_technology = tech_regenerative_hull_tissue }
			}
		}
		owner = {
			add_research_option = tech_regenerative_hull_tissue
			add_tech_progress = {
				tech = tech_regenerative_hull_tissue
				progress = 0.9
			}
		}
	}
	# scavengers option
	option = {
		name = DO_BOTH
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_scavengers
					has_valid_civic = civic_corporate_scavengers
				}
			}
		}
		from.planet = {
			add_deposit = d_AAA_crashed_ship_alloy_farm_zone
			last_added_deposit = {
				set_deposit_flag = keep_deposit_on_terraform
			}
		}
		owner = {
			if = {
				limit = {
					has_technology = tech_regenerative_hull_tissue
				}
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else = {
				add_research_option = tech_regenerative_hull_tissue
				add_tech_progress = {
					tech = tech_regenerative_hull_tissue
					progress = 0.9
				}
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Defect robots | from = arcsite
fleet_event = {
	id = AAA_arcsite.34
	title = AAA_arcsite.34.name
	desc = AAA_arcsite.34.desc
	picture = GFX_evt_robot_assembly_plant
	location = from
	show_sound = event_power_down

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Dismantle the robots
	option = {
		name = AAA_arcsite.34.a
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier3materialreward
				min = @tier3materialmin
				max = @tier3materialmax
			}
		}
	}
	# figure out how they work
	option = {
		# get next tier of robots
		name = AAA_arcsite.34.b
		trigger = {
			owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		owner = {
			if = {
				limit = {
					has_technology = tech_synthetic_leaders
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_synthetic_workers
				}
				add_research_option = tech_synthetic_leaders
				add_tech_progress = {
					tech = tech_synthetic_leaders
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_droid_workers
				}
				add_research_option = tech_synthetic_workers
				add_tech_progress = {
					tech = tech_synthetic_workers
					progress = 0.2
				}
			}
			else_if = {
				limit = {
					has_technology = tech_robotic_workers
				}
				add_research_option = tech_droid_workers
				add_tech_progress = {
					tech = tech_droid_workers
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_robotic_workers
				}
				add_research_option = tech_sapient_ai
				add_tech_progress = {
					tech = tech_droid_workers
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_powered_exoskeletons
				}
				add_research_option = tech_robotic_workers
				add_tech_progress = {
					tech = tech_robotic_workers
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_powered_exoskeletons
				add_tech_progress = {
					tech = tech_powered_exoskeletons
					progress = 0.5
				}
			}
		}
	}
	# scavengers option
	option = {
		name = DO_BOTH
		trigger = {
			owner = {
				OR = {
					has_valid_civic = civic_scavengers
					has_valid_civic = civic_corporate_scavengers
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier3materialreward
				min = @tier3materialmin
				max = @tier3materialmax
			}
		}
		owner = {
			if = {
				limit = {
					has_technology = tech_synthetic_leaders
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_synthetic_workers
				}
				add_research_option = tech_synthetic_leaders
				add_tech_progress = {
					tech = tech_synthetic_leaders
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_droid_workers
				}
				add_research_option = tech_synthetic_workers
				add_tech_progress = {
					tech = tech_synthetic_workers
					progress = 0.2
				}
			}
			else_if = {
				limit = {
					has_technology = tech_robotic_workers
				}
				add_research_option = tech_droid_workers
				add_tech_progress = {
					tech = tech_droid_workers
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_robotic_workers
				}
				add_research_option = tech_sapient_ai
				add_tech_progress = {
					tech = tech_droid_workers
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_powered_exoskeletons
				}
				add_research_option = tech_robotic_workers
				add_tech_progress = {
					tech = tech_robotic_workers
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_powered_exoskeletons
				add_tech_progress = {
					tech = tech_powered_exoskeletons
					progress = 0.5
				}
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# fate of the ship | from = arcsite
fleet_event = {
	id = AAA_arcsite.35
	title = AAA_arcsite.35.name
	desc = AAA_arcsite.35.desc
	picture = GFX_evt_relic_shipyard
	location = from
	show_sound = event_finding_loot

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Research the ship
	option = {
		name = SETUP_SHIP_RESEARCH_ZONE
		custom_tooltip = AAA_arcsite.35.a.tooltip
		hidden_effect = {
			from.planet = {
				remove_deposit = d_AAA_crashed_ship
				add_deposit = d_AAA_crashed_ship_tech
				last_added_deposit = {
					set_deposit_flag = keep_deposit_on_terraform
				}
			}
		}
	}
	# Scrap the ship
	option = {
		name = SETUP_SHIP_SCRAP_ZONE
		custom_tooltip = AAA_arcsite.35.b.tooltip
		hidden_effect = {
			from.planet = {
				remove_deposit = d_AAA_crashed_ship
				add_deposit = d_AAA_crashed_ship_scrap
				last_added_deposit = {
					set_deposit_flag = keep_deposit_on_terraform
				}
			}
		}
	}
	# Scavengers option
	option = {
		name = DO_BOTH
		custom_tooltip = AAA_arcsite.35.c.tooltip
		hidden_effect = {
			from.planet = {
				remove_deposit = d_AAA_crashed_ship
				add_deposit = d_AAA_crashed_ship_mixed
				last_added_deposit = {
					set_deposit_flag = keep_deposit_on_terraform
				}
			}
		}
	}
	# Servitor option
	option = {
		name = AAA_arcsite.35.d
		trigger = {
			owner = {
				#AND = {
					has_valid_civic = civic_machine_servitor
					# has_active_tradition = tr_archeology_museums
				#}
			}
		}
		custom_tooltip = AAA_arcsite.35.d.tooltip
		hidden_effect = {
			from.planet = {
				remove_deposit = d_AAA_crashed_ship
				add_deposit = d_AAA_crashed_ship_museum
				last_added_deposit = {
					set_deposit_flag = keep_deposit_on_terraform
				}
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

####################################
# "Perfect Planet" by Metallichydra
####################################

# Perfect Planet | from = arcsite
fleet_event = {
	id = AAA_arcsite.36
	title = AAA_arcsite.36.name
	desc = AAA_arcsite.36.desc
	picture = GFX_evt_gaia
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Perfect Planet | from = arcsite
fleet_event = {
	id = AAA_arcsite.37
	title = AAA_arcsite.37.name
	desc = AAA_arcsite.37.desc
	picture = GFX_evt_medieval_alien_civilization
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Perfect Planet | from = arcsite
fleet_event = {
	id = AAA_arcsite.38
	title = AAA_arcsite.38.name
	desc = AAA_arcsite.38.desc
	picture = GFX_evt_medieval_alien_civilization
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Perfect Planet | from = arcsite
fleet_event = {
	id = AAA_arcsite.39
	title = AAA_arcsite.39.name
	desc = AAA_arcsite.39.desc
	picture = GFX_evt_discovered_hidden_door
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Perfect Planet | from = arcsite
fleet_event = {
	id = AAA_arcsite.40
	title = AAA_arcsite.40.name
	desc = AAA_arcsite.40.desc
	picture = GFX_evt_habitable_dig_site
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Perfect Planet | from = arcsite
fleet_event = {
	id = AAA_arcsite.41
	title = AAA_arcsite.41.name
	desc = AAA_arcsite.41.desc
	picture = GFX_evt_shielded_planet
	location = from
	show_sound = event_finding_loot
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		owner = {
			add_relic = r_isolator
		}
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

####################################
# "Ship Debris" by Metallichydra
####################################

# This took way longer than anticipated

# fate (branching event)
fleet_event = {
	id = AAA_arcsite.42
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			10 = {
				modifier = {
					factor = 2
					from.planet = {
						is_planet_class = pc_barren
					}
				}
				fleet_event = { id = AAA_arcsite.43 } # Civilian Ship
			}
			5 = {
				modifier = {
					factor = 10
					from.planet = {
						is_planet_class = pc_frozen
					}
				}
				fleet_event = { id = AAA_arcsite.44 } # Research Ship
			}
			10 = {
				modifier = {
					factor = 2
					owner = {
						OR = {
							has_ethic = ethic_fanatic_militarist
							has_ethic = ethic_militarist
						}
					}
				}
				modifier = {
					factor = 0.5
					owner = {
						OR = {
							has_ethic = ethic_fanatic_pacifist
							has_ethic = ethic_pacifist
						}
					}
				}
				fleet_event = { id = AAA_arcsite.45 } # Military Ship
			}
			10 = {
				fleet_event = { id = AAA_arcsite.46 } # Cargo Ship
			}
		}
	}
}

# Civilian Ship | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.43
	title = AAA_arcsite.43.name
	desc = AAA_arcsite.43.desc
	picture = GFX_evt_cargoship_caravan
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		fromfrom = { set_archaeology_flag = civilian_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}


# Research Ship | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.44
	title = AAA_arcsite.44.name
	desc = AAA_arcsite.44.desc
	picture = GFX_evt_ghost_ship
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		fromfrom = { set_archaeology_flag = research_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# Military Ship | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.45
	title = AAA_arcsite.45.name
	desc = AAA_arcsite.45.desc
	picture = GFX_evt_ghost_ship
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		fromfrom = { set_archaeology_flag = military_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# Cargo Ship | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.46
	title = AAA_arcsite.46.name
	desc = AAA_arcsite.46.desc
	picture = GFX_evt_cargoship_caravan
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		fromfrom = { set_archaeology_flag = cargo_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# fate (branching event)
fleet_event = {
	id = AAA_arcsite.47
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = military_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.48 } # Intact
			}
			10 = {
				fleet_event = { id = AAA_arcsite.49 } # Damaged
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = research_ship
							has_archaeology_flag = cargo_ship
							has_archaeology_flag = civilian_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.50 } # Destroyed
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = research_ship
							has_archaeology_flag = civilian_ship
							has_archaeology_flag = cargo_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.51 } # Abandoned
			}
		}
	}
}

# intact | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.48
	title = AAA_arcsite.48.name
	desc = AAA_arcsite.48.desc
	picture = GFX_evt_engineering_bay
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = AAA_arcsite.48.a
		fromfrom = { set_archaeology_flag = intact_ship }
		fromfrom = { set_archaeology_flag = attempt_repairs }
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = AAA_arcsite.48.b
		fromfrom = { set_archaeology_flag = intact_ship }
		fromfrom = { set_archaeology_flag = salvage_materials }
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = AAA_arcsite.48.c
		fromfrom = { set_archaeology_flag = intact_ship }
		fromfrom = { set_archaeology_flag = study_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# damaged | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.49
	title = AAA_arcsite.49.name
	desc = AAA_arcsite.49.desc
	picture = GFX_evt_engineering_cache
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = AAA_arcsite.48.a
		fromfrom = { set_archaeology_flag = damaged_ship }
		fromfrom = { set_archaeology_flag = attempt_repairs }
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = AAA_arcsite.48.b
		fromfrom = { set_archaeology_flag = damaged_ship }
		fromfrom = { set_archaeology_flag = salvage_materials }
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = AAA_arcsite.48.c
		fromfrom = { set_archaeology_flag = damaged_ship }
		fromfrom = { set_archaeology_flag = study_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# destroyed | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.50
	title = AAA_arcsite.50.name
	desc = AAA_arcsite.50.desc
	picture = GFX_evt_physics_cache
	location = from
	show_sound = event_bad_omen
	archaeology = yes

	is_triggered_only = yes

	# salvage
	option = {
		name = AAA_arcsite.48.b
		fromfrom = { set_archaeology_flag = destroyed_ship }
		fromfrom = { set_archaeology_flag = salvage_materials }
		fromfrom = { set_site_progress_locked = no }
	}
	# study
	option = {
		name = AAA_arcsite.48.c
		fromfrom = { set_archaeology_flag = destroyed_ship }
		fromfrom = { set_archaeology_flag = study_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# abandoned | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.51
	title = AAA_arcsite.51.name
	desc = AAA_arcsite.51.desc
	picture = GFX_evt_engineering_bay
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	# attempt repairs
	option = {
		name = AAA_arcsite.48.a
		fromfrom = { set_archaeology_flag = intact_ship }
		fromfrom = { set_archaeology_flag = attempt_repairs }
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = AAA_arcsite.48.b
		fromfrom = { set_archaeology_flag = intact_ship }
		fromfrom = { set_archaeology_flag = salvage_materials }
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = AAA_arcsite.48.c
		fromfrom = { set_archaeology_flag = intact_ship }
		fromfrom = { set_archaeology_flag = study_ship }
		fromfrom = { set_site_progress_locked = no }
	}
}

# fate (branching event)
fleet_event = {
	id = AAA_arcsite.52
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = study_ship
							has_archaeology_flag = research_ship
							has_archaeology_flag = military_ship
							has_archaeology_flag = cargo_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.53 } # Create Constructor Ship
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = study_ship
							has_archaeology_flag = civilian_ship
							has_archaeology_flag = military_ship
							has_archaeology_flag = cargo_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.53 } # Create science Ship
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = study_ship
							has_archaeology_flag = research_ship
							has_archaeology_flag = civilian_ship
							has_archaeology_flag = cargo_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.53 } # Create Destroyer
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = study_ship
							has_archaeology_flag = research_ship
							has_archaeology_flag = military_ship
							has_archaeology_flag = civilian_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.53 } # Create Cruiser
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = study_ship
							has_archaeology_flag = intact_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.58 } # Failed Repair
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = attempt_repairs
							has_archaeology_flag = study_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.59 } # Gain Alloys
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = attempt_repairs
							has_archaeology_flag = salvage_materials
						}
					}
				}
				fleet_event = { id = AAA_arcsite.60 } # Gain Civilian tech
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = attempt_repairs
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = research_ship
							has_archaeology_flag = cargo_ship
							has_archaeology_flag = civilian_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.61 } # Gain Military tech
			}
			10 = {
				modifier = {
					factor = 0
					from = {
						OR = {
							has_archaeology_flag = attempt_repairs
							has_archaeology_flag = salvage_materials
							has_archaeology_flag = cargo_ship
							has_archaeology_flag = civilian_ship
						}
					}
				}
				fleet_event = { id = AAA_arcsite.62 } # Gain Science tech
			}
		}
	}
}

# Repair Successfull | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.53
	title = AAA_arcsite.53.name
	desc = AAA_arcsite.53.desc
	picture = GFX_evt_landing_ship
	location = from
	show_sound = event_ship_thrusters
	archaeology = yes

	is_triggered_only = yes

	# Civilian Ship
	option = {
		name = AAA_arcsite.53.a
		trigger = {
			fromfrom = {
				has_archaeology_flag = civilian_ship
			}
		}
		owner = {
			hidden_effect = {
				country_event = { id = AAA_arcsite.54 days = 10 } #Spawns Ship
			}
		}
		fromfrom = { set_site_progress_locked = no }
	}
	# Science ship
	option = {
		name = AAA_arcsite.53.a
		trigger = {
			fromfrom = {
				has_archaeology_flag = research_ship
			}
		}
		owner = {
			hidden_effect = {
				country_event = { id = AAA_arcsite.55 days = 10 } #Spawns Ship
			}
		}
		fromfrom = { set_site_progress_locked = no }
	}
	# Military ship
	option = {
		name = AAA_arcsite.53.a
		trigger = {
			fromfrom = {
				has_archaeology_flag = military_ship
			}
		}
		owner = {
			hidden_effect = {
				country_event = { id = AAA_arcsite.56 days = 10 } #Spawns Ship
			}
		}
		fromfrom = { set_site_progress_locked = no }
	}
	# Cargo ship
	option = {
		name = AAA_arcsite.53.a
		trigger = {
			fromfrom = {
				has_archaeology_flag = cargo_ship
			}
		}
		owner = {
			hidden_effect = {
				country_event = { id = AAA_arcsite.57 days = 10 } #Spawns Ship
			}
		}
		fromfrom = { set_site_progress_locked = no }
	}

	after = {
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Gain Civilian Ship
country_event = {
	id = AAA_arcsite.54
	title = AAA_arcsite.54.name
	desc = "AAA_arcsite.54.desc"
	picture = GFX_evt_ship_in_orbit
	location = from
	show_sound = event_default

	is_triggered_only = yes

	option = {
		name = AAA_arcsite.54.a
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					effect = {
						set_owner = prev
						create_ship = {
							name = random
							design = "NAME_Constructor"
							graphical_culture = owner
						}
						set_location = owner.capital_scope.star
					}
				}
			}
		}
	}
}

# Gain Science Ship
country_event = {
	id = AAA_arcsite.55
	title = AAA_arcsite.55.name
	desc = "AAA_arcsite.55.desc"
	picture = GFX_evt_ship_in_orbit
	location = from
	show_sound = event_default

	is_triggered_only = yes

	option = {
		name = AAA_arcsite.55.a
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					effect = {
						set_owner = prev
						create_ship = {
							name = random
							design = "NAME_Prototype"
							graphical_culture = owner
						}
						set_location = owner.capital_scope.star
					}
				}
			}
		}
	}
}

# Gain Military Ship
country_event = {
	id = AAA_arcsite.56
	title = AAA_arcsite.56.name
	desc = "AAA_arcsite.56.desc"
	picture = GFX_evt_ship_in_orbit
	location = from
	show_sound = event_default

	is_triggered_only = yes


	option = {
		name = AAA_arcsite.56.a
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					effect = {
						set_owner = prev
						create_ship = {
							name = random
							design = "NAME_F79"
							graphical_culture = owner
						}
						set_location = owner.capital_scope.star
					}
				}
			}
		}
	}
}

# Gain Cargo Ship
country_event = {
	id = AAA_arcsite.57
	title = AAA_arcsite.57.name
	desc = "AAA_arcsite.57.desc"
	picture = GFX_evt_ship_in_orbit
	location = from
	show_sound = event_default

	is_triggered_only = yes


	option = {
		name = AAA_arcsite.57.a
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					effect = {
						set_owner = prev
						create_ship = {
							name = random
							design = "NAME_Derelict"
							graphical_culture = owner
						}
						set_location = owner.capital_scope.star
					}
				}
			}
		}
	}
}

# Repair Unsuccessfull | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.58
	title = AAA_arcsite.58.name
	desc = AAA_arcsite.58.desc
	picture = GFX_evt_debris
	location = from
	show_sound = event_ship_explosion
	archaeology = yes

	is_triggered_only = yes

	# Civilian Ship
	option = {
		name = AAA_arcsite.58.a
		fromfrom = { set_site_progress_locked = no }
	}
}

# ship salvaged | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.59
	title = AAA_arcsite.59.name
	desc = AAA_arcsite.59.desc
	picture = GFX_evt_salvager_enclave_disassembly
	location = from
	show_sound = event_construction
	archaeology = yes

	is_triggered_only = yes

	# ok
	option = {
		name = OK
		owner = {
			add_resource = { alloys = 200 }
		}
		fromfrom = { set_site_progress_locked = no }
	}

	after = {
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Civilian Tech | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.60
	title = AAA_arcsite.60.name
	desc = AAA_arcsite.60.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_default

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Gain Next Reactor Tech
	option = {
		name = AAA_arcsite.60.a
		owner = {
			if = {
				limit = {
					has_technology = tech_zero_point_power
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_antimatter_power
				}
				add_research_option = tech_zero_point_power
				add_tech_progress = {
					tech = tech_zero_point_power
					progress = 0.2
				}
			}
			else_if = {
				limit = {
					has_technology = tech_cold_fusion_power
				}
				add_research_option = tech_antimatter_power
				add_tech_progress = {
					tech = tech_antimatter_power
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_fusion_power
				}
				add_research_option = tech_cold_fusion_power
				add_tech_progress = {
					tech = tech_cold_fusion_power
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_fusion_power
				add_tech_progress = {
					tech = tech_fusion_power
					progress = 0.5
				}
			}
		}
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Military Tech | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.61
	title = AAA_arcsite.61.name
	desc = AAA_arcsite.61.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_default

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Gain Next Laser Tech
	option = {
		name = AAA_arcsite.61.a
		owner = {
			if = {
				limit = {
					has_technology = tech_lasers_5
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_4
				}
				add_research_option = tech_lasers_5
				add_tech_progress = {
					tech = tech_lasers_5
					progress = 0.2
				}
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_3
				}
				add_research_option = tech_lasers_4
				add_tech_progress = {
					tech = tech_lasers_4
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_2
				}
				add_research_option = tech_lasers_3
				add_tech_progress = {
					tech = tech_cold_fusion_power
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_lasers_2
				add_tech_progress = {
					tech = tech_lasers_2
					progress = 0.5
				}
			}
		}
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Science Tech | fromfrom = arcsite
fleet_event = {
	id = AAA_arcsite.62
	title = AAA_arcsite.62.name
	desc = AAA_arcsite.62.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_default

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Gain Next Sensor Tech
	option = {
		name = AAA_arcsite.62.a
		owner = {
			if = {
				limit = {
					has_technology = tech_sensors_4
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			else_if = {
				limit = {
					has_technology = tech_sensors_3
				}
				add_research_option = tech_sensors_4
				add_tech_progress = {
					tech = tech_sensors_4
					progress = 0.3
				}
			}
			else_if = {
				limit = {
					has_technology = tech_sensors_2
				}
				add_research_option = tech_sensors_3
				add_tech_progress = {
					tech = tech_sensors_3
					progress = 0.4
				}
			}
			else = {
				add_research_option = tech_sensors_2
				add_tech_progress = {
					tech = tech_sensors_2
					progress = 0.5
				}
			}
		}
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

#####################################
# "Ancient Reactor" by Metallichydra
#####################################

# Ancient Reactor Found | from = arcsite
fleet_event = {
	id = AAA_arcsite.63
	title = AAA_arcsite.63.name
	desc = AAA_arcsite.63.desc
	picture = GFX_evt_relic_world_street
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Control Room Found | from = arcsite
fleet_event = {
	id = AAA_arcsite.64
	title = AAA_arcsite.64.name
	desc = AAA_arcsite.64.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	option = {
		name = AAA_arcsite.64.a
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Computer Log | from = arcsite
fleet_event = {
	id = AAA_arcsite.65
	title = AAA_arcsite.65.name
	desc = AAA_arcsite.65.desc
	picture = GFX_evt_intelligence_report
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	option = {
		name = AAA_arcsite.65.a
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# The Cause (Hidden) | from = arcsite
fleet_event = {
	id = AAA_arcsite.66
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		# Fixed outcomes if the arc site is abandoned part way or inherited from another empire.
		random_list = {
			1 = {
				fleet_event = { id = AAA_arcsite.67 } # Post-Apocalyptic Power
			}
			1 = {
				fleet_event = { id = AAA_arcsite.68 } # Abandoned Powerplant
			}
			1 = {
				fleet_event = { id = AAA_arcsite.69 } # Hopeless Construction
			}
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Post-Apocalyptic Power | from = arcsite
fleet_event = {
	id = AAA_arcsite.67
	title = AAA_arcsite.67.name
	desc = AAA_arcsite.67.desc
	picture = GFX_evt_tomb_world
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		from = {
			planet = {
				add_deposit = d_AAA_ancient_reactor
			}
		}
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Abandoned Powerplant | from = arcsite
fleet_event = {
	id = AAA_arcsite.68
	title = AAA_arcsite.68.name
	desc = AAA_arcsite.68.desc
	picture = GFX_evt_tomb_world
	location = from
	show_sound = event_finding_loot
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		from = {
			planet = {
				add_deposit = d_AAA_ancient_reactor
			}
		}
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Hopeless Construction | from = arcsite
fleet_event = {
	id = AAA_arcsite.69
	title = AAA_arcsite.69.name
	desc = AAA_arcsite.69.desc
	picture = GFX_evt_relic_world_street
	location = from
	show_sound = event_finding_loot
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}

	# Fascinating
	option = {
		name = FASCINATING
		from = {
			planet = {
				add_deposit = d_AAA_derelict_reactor
			}
		}
	}

	after = {
		fromfrom = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

#############################################
# "Ancient Antimatter" Bomb by Metallichydra
#############################################

# Ancient Weapons Facility | from = arcsite
fleet_event = {
	id = AAA_arcsite.70
	title = AAA_arcsite.70.name
	desc = AAA_arcsite.70.desc
	picture = GFX_evt_discovered_hidden_door
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	# Blow Up
	option = {
		name = AAA_arcsite.70.a
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = volatile_motes
					value >= 1
				}
			}
		}
		owner = {
			add_resource = { volatile_motes = -1 }
		}
		from = {
			set_archaeology_flag = BlowUpDoor
		}
	}
	# Laser
		option = {
		name = AAA_arcsite.70.b
		from = {
			set_archaeology_flag = DestroyedDoor
		}
	}
	# Dismantle
		option = {
		name = AAA_arcsite.70.c
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		from = {
			set_archaeology_flag = DismantledDoor
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Disturbing Plans | from = arcsite
fleet_event = {
	id = AAA_arcsite.71
	title = AAA_arcsite.71.name
	desc = AAA_arcsite.71.desc
	picture = GFX_evt_ancient_databank
	location = from
	show_sound = event_default
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		owner = {
			set_country_flag = AAA_found_plans
		}
		from = {
			planet = {
				add_modifier = {
					modifier = AAA_feelings_of_doom
				}
			}
		}
	}

	# Proceed as normal
	option = {
		name = AAA_arcsite.71.a
	}
	# Scan the blueprints
	option = {
		name = AAA_arcsite.71.b
		trigger = {
			owner = {
				NOT = { has_technology = tech_missiles_3 }
				NOT = { is_pacifist = yes }
			}
		}
		from = {
			set_archaeology_flag = ScannedPlans
		}
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Race Against the Clock | from = arcsite
fleet_event = {
	id = AAA_arcsite.72
	title = AAA_arcsite.72.name
	desc = AAA_arcsite.72.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_finding_loot
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		owner = {
			set_country_flag = AAA_found_clock
		}
	}

	option = {
		name = AAA_arcsite.73.a
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Confusing Hallways | from = arcsite
fleet_event = {
	id = AAA_arcsite.73
	title = AAA_arcsite.73.name
	desc = AAA_arcsite.73.desc
	picture = GFX_evt_discovered_hidden_door
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	option = {
		name = AAA_arcsite.73.a
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# The Control Room | from = arcsite
fleet_event = {
	id = AAA_arcsite.74
	title = AAA_arcsite.74.name
	desc = AAA_arcsite.74.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_mystic_reveal
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	option = {
		name = AAA_arcsite.74.a
	}

	after = {
		from = { set_site_progress_locked = no }
	}
}

# Deactivating the Bomb (Before 10 years have passed) | from = arcsite
fleet_event = {
	id = AAA_arcsite.75
	title = AAA_arcsite.75.name
	desc = AAA_arcsite.75.desc
	picture = GFX_evt_glitchy_matrix
	location = from
	show_sound = event_finding_loot
	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	option = {
		name = AAA_arcsite.75.a
		hidden_effect = {
			leader = {
				save_event_target_as = dead_scientist
				exile_leader_as = dead_scientist
			}
			owner = { set_country_flag = AAA_wrong_wire }
			from = {
				planet = {
					planet_event = { id = AAA_arcsite.76 days = 1 }
				}
			}
		}
	}

	option = {
		name = AAA_arcsite.75.b
		hidden_effect = {
			leader = {
				save_event_target_as = dead_scientist
				exile_leader_as = dead_scientist
			}
			owner = { set_country_flag = AAA_wrong_wire }
			from = {
				planet = {
					planet_event = { id = AAA_arcsite.76 days = 1 }
				}
			}
		}
	}

	option = {
		name = AAA_arcsite.75.c
		From = {
			Planet = {
				set_planet_flag = AAA_deactivated_bomb
			}
		}
		hidden_effect = {
			leader = {
				save_event_target_as = savior_scientist
				#add_trait = AAA_planet_savior
			}
			from = {
				planet = {
					save_event_target_as = AAA_antimatter_planet
					add_deposit = d_AAA_ancient_bunker
				}
			}
			owner = {
				country_event = { id = AAA_arcsite.79 days = 1 }
			}
		}
	}

	option = {
		name = AAA_arcsite.75.d
	}

	after = {
		from = {
			planet = {
				if = {
					limit = { has_modifier = AAA_feelings_of_doom }
					remove_modifier = AAA_feelings_of_doom
				}
			}
		}
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

# The bomb explodes ( hidden )
planet_event = {
	id = AAA_arcsite.76
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = AAA_deactivated_bomb }
		NOT = { has_planet_flag = AAA_activated_bomb }
	}

	immediate = {
		set_planet_flag = AAA_activated_bomb
		save_event_target_as = AAA_antimatter_planet
		if = {
			limit = { is_colony = yes }
			owner = {
				set_country_flag = AAA_had_colony
			}
			every_owned_pop_group = {
				kill_all_pop = yes
			}
			destroy_colony = yes
		}
		change_pc = { class = pc_shattered inherit_entity = yes }
		if = {
			limit = {
				exists = event_target:dead_scientist
			}
			space_owner = {
				country_event = { id = AAA_arcsite.77 }
			}
		}
		else_if = {
			limit = { exists = event_target:AAA_bomb_site.Leader }
			event_target:AAA_bomb_site = {
				Leader = {
					save_event_target_as = dead_scientist
					exile_leader_as = dead_scientist
				}
			}
			space_owner = {
				country_event = { id = AAA_arcsite.77 }
			}
		}
		else = {
			space_owner = {
				country_event = { id = AAA_arcsite.78 }
			}
		}
		destroy_archaeological_site = event_target:AAA_bomb_site
		clear_global_event_target = AAA_bomb_site
	}
}

# The bomb explodes
country_event = {
	id = AAA_arcsite.77
	title = AAA_arcsite.77.name
	desc = {
		trigger = {
			# The former planet known as _name_ has exploded, leaving only the shattered remnants of it's shell behind.
			text = AAA_arcsite.77.desc
			text = newline
			# What caused this is uknown
			success_text = {
				text = AAA_arcsite.77.desc.a
				NOT = { has_country_flag = AAA_found_plans }
			}
			# Apparently the antimatter bomb depicted on the blueprints had already been constructed. Why it exploded at this moment is as of yet unknown, although it is assumed that the _leader_ or his/her team set it off by accident
			success_text = {
				text = AAA_arcsite.77.desc.b
				has_country_flag = AAA_found_plans
				NOT = { has_country_flag = AAA_found_clock }
			}
			# _leader_ and his/her team perished in the explosion
			success_text = {
				text = AAA_arcsite.77.desc.c
				has_country_flag = AAA_found_plans
				has_country_flag = AAA_found_clock
				NOT = { has_country_flag = AAA_wrong_wire }
			}
			# _leader_ and his/her team perished in the explosion when he/she attempted to disarm the bomb
			success_text = {
				text = AAA_arcsite.77.desc.d
				has_country_flag = AAA_found_plans
				has_country_flag = AAA_found_clock
				has_country_flag = AAA_wrong_wire
			}
			success_text = {
				text = AAA_arcsite.77.desc.e
				has_country_flag = AAA_had_colony
			}
		}
	}
	picture = GFX_evt_exploding_planet
	show_sound = event_super_explosion

	is_triggered_only = yes

	after = {
		if = {
			limit = { exists = event_target:dead_scientist }
			event_target:dead_scientist = {
				kill_leader = { show_notification = no }
			}
		}
	}

	option = {
		name = AAA_arcsite.77.a
	}
}

# The bomb explodes ( no scientist )
country_event = {
	id = AAA_arcsite.78
	title = AAA_arcsite.78.name
	desc = {
		trigger = {
			# The former planet known as _name_ has exploded, leaving only the shattered remnants of it's shell behind.
			text = AAA_arcsite.78.desc
			text = newline
			# What caused this is uknown
			success_text = {
				text = AAA_arcsite.78.desc.a
				NOT = { has_country_flag = AAA_found_plans }
			}
			# Apparently the antimatter bomb depicted on the blueprints had already been constructed. Why it exploded at this moment is as of yet unknown.
			success_text = {
				text = AAA_arcsite.78.desc.b
				has_country_flag = AAA_found_plans
				NOT = { has_country_flag = AAA_found_clock }
			}
			# It exploded as it's countdown reached 0, just as predicted
			success_text = {
				text = AAA_arcsite.78.desc.c
				has_country_flag = AAA_found_plans
				has_country_flag = AAA_found_clock
			}
			success_text = {
				text = AAA_arcsite.78.desc.d
				has_country_flag = AAA_had_colony
			}
		}
	}
	picture = GFX_evt_exploding_planet
	show_sound = event_super_explosion

	is_triggered_only = yes

	option = {
		name = AAA_arcsite.78.a
	}
}

# The bomb is deactivated
country_event = {
	id = AAA_arcsite.79
	title = AAA_arcsite.79.name
	desc = AAA_arcsite.79.desc
	picture = GFX_evt_grand_speech
	show_sound = event_finding_loot

	is_triggered_only = yes

	option = {
		name = AAA_arcsite.79.a
	}
}

# The bomb is deactivated

######################################
# "Deadly Imitators" by Metallichydra
######################################
