##########################
#
# Forgotten History Precursor Events
#
##########################

namespace = AAA_precursor

######################################
# "THE PLEXIAN SWARM" by Metallichydra
######################################

####################################
# "Plexian Debris"
####################################

# Plexi Introduction
# via on_survey = {} | this = surveying vessel
ship_event = {
	id = AAA_precursor.1
	title = "AAA_precursor.1.name"
	desc = "AAA_precursor.1.desc"
	picture = GFX_evt_crashed_station
	show_sound = event_default
	location = from

	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
		owner = { scfe_can_find_precursor = yes }
		OR = {
			AND = {
				NOT = { has_global_flag = Precursor_Selection_installed }
				owner = {
					is_ai = no
					has_precursor_intro = no
				}
			}
			AND = {
				has_global_flag = Precursor_Selection_installed
				owner = {
					is_ai = no
					NOT = { has_country_flag = plexi_intro }
					has_country_flag = picked_plexi
				}
			}
		}
		solar_system = {
			has_star_flag = precursor_plexi
			NOR = {
				is_same_value = root.owner.capital_scope.solar_system
				has_star_flag = sol_system
			}
		}
		NOT = { has_global_flag = plexi_started }
		FROM = {
			has_anomaly = no
			is_star = no
			NOT = { exists = archaeological_site }
			NOT = { has_planet_flag = suppress_archaeological_sites }
			NOR = {
				is_planet_class = pc_gas_giant
				is_planet_class = pc_molten
				is_planet_class = pc_toxic
			}
		}
	}
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = @origin_shoulders_multiplier
			owner = {
				has_origin = origin_shoulders_of_giants
				has_country_flag = origin_shoulders_closure
			}
		}
		modifier = {
			factor = 1000
			owner = {
				has_country_flag = picked_plexi
			}
		}
		modifier = {
			factor = 0
			owner = {
				has_country_flag = PreSelect_Recent_Discovery
			}
		}
	}

	immediate = {
		set_global_flag = plexi_started
		owner = { set_country_flag = plexi_intro }
		owner = { set_timed_country_flag = { flag = PreSelect_Recent_Discovery days = 180 } }
		if = {
			limit = {
				has_PreSelect_active = no
			}
			owner = { set_country_flag = vultaum_intro }
		}
		solar_system = { set_star_flag = first_plexi_site@root.owner }
	}

	option = {
		name = CURIOUS
		hidden_effect = {
			owner = { country_event = { id = story.5 days = 30 } }
			from = { create_archaeological_site = plexi_digsite_1 }
		}
	}
}

# Plexi Digsite Stage 1
fleet_event = {
	id = AAA_precursor.2
	#archaeology_window = yes
	title = "AAA_precursor.2.name"
	desc = "AAA_precursor.2.desc"
	picture = GFX_evt_scanning_remains
	show_sound = event_ship_bridge
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "DISCONCERTING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 2
fleet_event = {
	id = AAA_precursor.3
	#archaeology_window = yes
	title = "AAA_precursor.3.name"
	desc = "AAA_precursor.3.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_ship_bridge
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "DISCONCERTING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 3
fleet_event = {
	id = AAA_precursor.4
	title = "AAA_precursor.4.name"
	desc = "AAA_precursor.4.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "ancrel.2024.a"
		medium_artifact_reward = yes
		owner = {
			hidden_effect = {
				country_event = { id = AAA_precursor.5 } #Spawns 1st Plexi System
			}
		}
	}
}

#The 1st Plexi Colony (hidden)
country_event = {
	id = AAA_precursor.5
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = plexi_colony_1_system_discovered
		# set_country_flag = plexi_colony_1_system
		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_plexi }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_plexi }
				save_event_target_as = plexi_1_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = plexi_1_spawn_system
			}
		}
		event_target:plexi_1_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "plexi_1_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = AAA_precursor.6 days = 10 }
	}
}

#The 1st Plexi Colony system
country_event = {
	id = AAA_precursor.6
	title = "AAA_precursor.6.name"
	desc = "AAA_precursor.6.desc"
	picture = GFX_evt_shielded_planet
	location = event_target:plexi_1_system
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = plexi_1_system }
			save_event_target_as = plexi_1_system
		}
		# observer_event = { id = observer.85 }
		event_target:plexi_1_system = {
			random_neighbor_system = {
				save_event_target_as = plexi_1_neighbor
			}
		}
	}

	option = {
		name = INCREDIBLE
		owner = {
			begin_event_chain = {
				event_chain = "plexi_chain"
				target = this
			}
			event_target:plexi_1_planet = {
				enable_special_project = {
					name = "PLEXI_1_SHIELD"
					location = this
					owner = root
				}
			}
			country_event = { id = AAA_precursor.8 days = 30 }
		}
	}
}

### deshield completed
# try fromfrom if doesn't work
ship_event = {
	id = AAA_precursor.7
	title = "AAA_precursor.7.name"
	desc = "AAA_precursor.7.desc"
	picture = GFX_evt_big_landing_ship
	show_sound = event_mystic_reveal
	location = FROM

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = first_plexi_site@root.owner
				has_star_flag = plexi_1_system
			}
			save_event_target_as = first_plexi_site
		}
	}
	option = {
		name = INTRIGUING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_event_chain_counter = {
				event_chain = "plexi_chain"
				counter = "plexi_colonies"
				amount = 1
			}
		}
		fromfrom = {
			clear_planet_modifiers = yes
			change_pc = pc_nuked
			reset_planet = yes
			create_archaeological_site = plexi_digsite_2
		}
	}
}

# Signal Revieved
country_event = {
	id = AAA_precursor.8
	title = "AAA_precursor.8.name"
	desc = "AAA_precursor.8.desc"
	location = event_target:plexi_1_planet
	show_sound = event_alien_signal
	picture = GFX_evt_mysterious_signal

	is_triggered_only = yes

	option = {
		name = "DISCONCERTING"
		owner = {
			country_event = { id = AAA_precursor.9 days = 1 }
		}
	}
}

# Warning
country_event = {
	id = AAA_precursor.9
	title = "AAA_precursor.9.name"
	desc = "AAA_precursor.9.desc"
	location = event_target:plexi_1_planet
	show_sound = event_yellow_alert
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "DISCONCERTING"
	}
}

####################################
# "Plexian Colony remains"
####################################

# Plexi Digsite Stage 1
fleet_event = {
	id = AAA_precursor.10
	#archaeology_window = yes
	title = "AAA_precursor.10.name"
	desc = "AAA_precursor.10.desc"
	picture = GFX_evt_scanning_remains
	show_sound = event_bad_omen
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "DISCONCERTING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 2
fleet_event = {
	id = AAA_precursor.11
	#archaeology_window = yes
	title = "AAA_precursor.11.name"
	desc = "AAA_precursor.11.desc"
	picture = GFX_evt_clones
	show_sound = event_default
	location = from

	archaeology = yes

	specimen = AAA_organic_remains

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "FASCINATING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 3
fleet_event = {
	id = AAA_precursor.12
	#archaeology_window = yes
	title = "AAA_precursor.12.name"
	desc = "AAA_precursor.12.desc"
	picture = GFX_evt_progenitor_throne
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "FASCINATING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 4
fleet_event = {
	id = AAA_precursor.13
	title = "AAA_precursor.13.name"
	desc = "AAA_precursor.13.desc"
	picture = GFX_evt_intelligence_report
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "CURIOUS"
		medium_artifact_reward = yes
		owner = {
			hidden_effect = {
				country_event = { id = AAA_precursor.14 days = 10 } #Spawns 2nd Plexi System
			}
		}
	}
}

#The 2nd Plexi Colony (hidden)
country_event = {
	id = AAA_precursor.14
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = plexi_colony_2_system_discovered
		# set_country_flag = plexi_colony_1_system
		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_plexi }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_plexi }
				save_event_target_as = plexi_2_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = plexi_2_spawn_system
			}
		}
		event_target:plexi_2_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "plexi_2_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = AAA_precursor.15 days = 5 }
	}
}

#The 2nd Plexi Colony system
country_event = {
	id = AAA_precursor.15
	title = "AAA_precursor.15.name"
	desc = "AAA_precursor.15.desc"
	picture = GFX_evt_star_chart
	location = event_target:plexi_2_system
	show_sound = event_alien_signal

	is_triggered_only = yes

	specimen = AAA_plexian_star_chart

	immediate = {
		random_system = {
			limit = { has_star_flag = plexi_2_system }
			save_event_target_as = plexi_2_system
		}
		# observer_event = { id = observer.85 }
		event_target:plexi_2_system = {
			random_neighbor_system = {
				save_event_target_as = plexi_2_neighbor
			}
		}
	}

	option = {
		name = INCREDIBLE
		# end_event_chain = "baol_chain"
		# custom_tooltip = ancrel.2015.a.tooltip
		owner = {
			event_target:plexi_2_planet = {
				enable_special_project = {
					name = "PLEXI_2_SHIELD"
					location = this
					owner = root
				}
			}
		}
	}
}

### deshield completed
# try fromfrom if doesn't work
ship_event = {
	id = AAA_precursor.16
	title = "AAA_precursor.16.name"
	desc = "AAA_precursor.16.desc"
	picture = GFX_evt_big_landing_ship
	show_sound = event_mystic_reveal
	location = FROM

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = first_plexi_site@root.owner
				has_star_flag = plexi_1_system
				has_star_flag = plexi_2_system
			}
			save_event_target_as = second_plexi_site
		}
	}
	option = {
		name = INTRIGUING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_event_chain_counter = {
				event_chain = "plexi_chain"
				counter = "plexi_colonies"
				amount = 1
			}
		}
		fromfrom = {
			clear_planet_modifiers = yes
			change_pc = pc_nuked
			reset_planet = yes
			create_archaeological_site = plexi_digsite_3
		}
	}
}

####################################
# "Plexian black hole observation"
####################################

# Plexi Digsite Stage 1
fleet_event = {
	id = AAA_precursor.17
	#archaeology_window = yes
	title = "AAA_precursor.17.name"
	desc = "AAA_precursor.17.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "FASCINATING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 2
fleet_event = {
	id = AAA_precursor.18
	#archaeology_window = yes
	title = "AAA_precursor.18.name"
	desc = "AAA_precursor.18.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "FASCINATING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 3
fleet_event = {
	id = AAA_precursor.19
	#archaeology_window = yes
	title = "AAA_precursor.19.name"
	desc = "AAA_precursor.19.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 4
fleet_event = {
	id = AAA_precursor.20
	title = "AAA_precursor.20.name"
	desc = "AAA_precursor.20.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "DISCONCERTING"
		medium_artifact_reward = yes
		owner = {
			hidden_effect = {
				country_event = { id = AAA_precursor.23 days = 10 } #Spawns 3rd Plexi System
			}
		}
	}
}

# Warning
country_event = {
	id = AAA_precursor.22
	title = "AAA_precursor.22.name"
	desc = "AAA_precursor.22.desc"
	location = event_target:plexi_1_planet
	show_sound = event_yellow_alert
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "DISCONCERTING"
	}
}

#The 3rd Plexi Colony (hidden)
country_event = {
	id = AAA_precursor.23
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = plexi_colony_3_system_discovered
		# set_country_flag = plexi_colony_1_system
		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_plexi }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_plexi }
				save_event_target_as = plexi_3_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = plexi_3_spawn_system
			}
		}
		event_target:plexi_3_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "plexi_3_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = AAA_precursor.24 days = 5 }
	}
}

#The 3rd Plexi Colony system
country_event = {
	id = AAA_precursor.24
	title = "AAA_precursor.24.name"
	desc = "AAA_precursor.24.desc"
	picture = GFX_evt_mysterious_signal
	location = event_target:plexi_3_system
	show_sound = event_alien_signal

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = plexi_3_system }
			save_event_target_as = plexi_3_system
		}
		# observer_event = { id = observer.85 }
		event_target:plexi_3_system = {
			random_neighbor_system = {
				save_event_target_as = plexi_3_neighbor
			}
		}
	}

	option = {
		name = "DISCONCERTING"
		# end_event_chain = "baol_chain"
		# custom_tooltip = ancrel.2015.a.tooltip
		owner = {
			event_target:plexi_3_planet = {
				enable_special_project = {
					name = "PLEXI_3_SHIELD"
					location = this
					owner = root
				}
			}
			country_event = { id = AAA_precursor.22 days = 30 }
		}
		# Remove Anomalies first
		#event_target:plexi_3_system = {
		#	every_system_planet = {
		#		limit = {
		#			is_planet_class = pc_shielded
		#			has_planet_flag = AAA_plexian_shielded_planet
		#		}
		#		enable_special_project = {
		#			name = "TAKE_DOWN_ANCIENT_SHIELD"
		#			location = this
		#			owner = root
		#		}
		#	}
		#}
	}
}

### deshield completed
# try fromfrom if doesn't work
ship_event = {
	id = AAA_precursor.25
	title = "AAA_precursor.25.name"
	desc = "AAA_precursor.25.desc"
	picture = GFX_evt_big_landing_ship
	show_sound = event_mystic_reveal
	location = FROM

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = first_plexi_site@root.owner
				has_star_flag = plexi_1_system
				has_star_flag = plexi_2_system
				has_star_flag = plexi_3_system
			}
			save_event_target_as = third_plexi_site
		}
	}

	option = {
		name = INTRIGUING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_event_chain_counter = {
				event_chain = "plexi_chain"
				counter = "plexi_colonies"
				amount = 1
			}
		}
		fromfrom = {
			clear_planet_modifiers = yes
			change_pc = pc_nuked
			reset_planet = yes
			create_archaeological_site = plexi_digsite_4
		}
	}
}

####################################
# "Plexian City"
####################################

# Plexi Digsite Stage 1
fleet_event = {
	id = AAA_precursor.26
	#archaeology_window = yes
	title = "AAA_precursor.26.name"
	desc = "AAA_precursor.26.desc"
	picture = GFX_evt_baol_ruins
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	is_triggered_only = yes

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 2
fleet_event = {
	id = AAA_precursor.27
	#archaeology_window = yes
	title = "AAA_precursor.27.name"
	desc = "AAA_precursor.27.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "FASCINATING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 3
fleet_event = {
	id = AAA_precursor.28
	#archaeology_window = yes
	title = "AAA_precursor.28.name"
	desc = "AAA_precursor.28.desc"
	picture = GFX_evt_scanning_remains
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "ancrel.2001.a"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 4
fleet_event = {
	id = AAA_precursor.29
	title = "AAA_precursor.29.name"
	desc = "AAA_precursor.29.desc"
	picture = GFX_evt_star_chart
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	specimen = AAA_plexian_tombstone

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "ancrel.2024.a"
		medium_artifact_reward = yes
		owner = {
			hidden_effect = {
				country_event = { id = AAA_precursor.30 days = 10 } #Spawns Plexi Home System
			}
		}
	}
}

#The Plexi Homeworld (hidden)
country_event = {
	id = AAA_precursor.30
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = plexi_homeworld_system_discovered
		set_country_flag = plexi_homeworld_system
		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_plexi }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_plexi }
				save_event_target_as = plexi_homeworld_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = plexi_homeworld_spawn_system
			}
		}
		event_target:plexi_homeworld_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "plexi_homeworld_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = AAA_precursor.31 days = 5 }
	}
}

#Th Plexi Homeworld system
country_event = {
	id = AAA_precursor.31
	title = "AAA_precursor.31.name"
	desc = "AAA_precursor.31.desc"
	picture = GFX_evt_star_chart
	location = event_target:plexi_homeworld_system
	show_sound = event_finding_loot

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = plexi_homeworld_system }
			save_event_target_as = plexi_homeworld_system
		}
		# observer_event = { id = observer.85 }
		event_target:plexi_homeworld_system = {
			random_neighbor_system = {
				save_event_target_as = plexi_homeworld_neighbor
			}
		}
	}

	option = {
		name = "DISCONCERTING"
		# end_event_chain = "baol_chain"
		# custom_tooltip = ancrel.2015.a.tooltip
		owner = {
			event_target:plexi_homeworld_planet = {
				enable_special_project = {
					name = "PLEXI_HOMEWORLD_SHIELD"
					location = this
					owner = root
				}
			}
			country_event = { id = AAA_precursor.32 days = 10 }
		}
	}
}

# Signal Revieved
country_event = {
	id = AAA_precursor.32
	title = "AAA_precursor.32.name"
	desc = "AAA_precursor.32.desc"
	location = event_target:plexi_1_planet
	show_sound = event_alien_signal
	picture = GFX_evt_mysterious_signal

	is_triggered_only = yes

	option = {
		name = "DISCONCERTING"
		owner = {
			country_event = { id = AAA_precursor.33 days = 1 }
		}
	}
}

# Warning
country_event = {
	id = AAA_precursor.33
	title = "AAA_precursor.33.name"
	desc = "AAA_precursor.33.desc"
	location = event_target:plexi_1_planet
	show_sound = event_yellow_alert
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "AAA_precursor.33.a"
		response_text = "AAA_precursor.33.a.response"
		is_dialog_only = yes
	}
	option = {
		name = "AAA_precursor.33.b"
		response_text = "AAA_precursor.33.b.response"
		is_dialog_only = yes
	}
	option = {
		name = "AAA_precursor.33.c"
		response_text = "AAA_precursor.33.c.response"
		is_dialog_only = yes
	}
	option = {
		name = "AAA_precursor.33.d"
		owner = {
		hidden_effect = { country_event = { id = AAA_precursor.34 } }
		}
	}
	option = {
		name = "AAA_precursor.33.e"
		owner = {
		hidden_effect = { country_event = { id = AAA_precursor.34 } }
		}
	}
}

# Warning
country_event = {
	id = AAA_precursor.34
	title = "AAA_precursor.34.name"
	desc = "AAA_precursor.34.desc"
	location = event_target:plexi_1_planet
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "DISCONCERTING"
	}
}

### deshield completed
# try fromfrom if doesn't work
ship_event = {
	id = AAA_precursor.35
	title = "AAA_precursor.35.name"
	desc = "AAA_precursor.35.desc"
	picture = GFX_evt_big_landing_ship
	show_sound = event_mystic_reveal
	location = FROM

	is_triggered_only = yes

	option = {
		name = INTRIGUING
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			set_country_flag = plexi_world_found
			end_event_chain = "plexi_chain"
			if = {
				limit = { has_ancrel = yes }
				custom_tooltip = plexi_artifact_research_unlocked
			}
			#add_event_chain_counter = {
			#	event_chain = "plexi_chain"
			#	counter = "plexi_colonies"
			#	amount = 1
			#}
		}
		fromfrom = {
			clear_planet_modifiers = yes
			change_pc = pc_nuked
			reset_planet = yes
			create_archaeological_site = plexi_digsite_5
		}
	}
}

# Plexi Digsite Stage 1
fleet_event = {
	id = AAA_precursor.36
	#archaeology_window = yes
	title = "AAA_precursor.36.name"
	desc = "AAA_precursor.36.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 2
fleet_event = {
	id = AAA_precursor.37
	#archaeology_window = yes
	title = "AAA_precursor.37.name"
	desc = "AAA_precursor.37.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 3
fleet_event = {
	id = AAA_precursor.38
	#archaeology_window = yes
	title = "AAA_precursor.38.name"
	desc = "AAA_precursor.38.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 4
fleet_event = {
	id = AAA_precursor.39
	#archaeology_window = yes
	title = "AAA_precursor.39.name"
	desc = "AAA_precursor.39.desc"
	picture = GFX_evt_intelligence_report
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 5
fleet_event = {
	id = AAA_precursor.40
	#archaeology_window = yes
	title = "AAA_precursor.40.name"
	desc = "AAA_precursor.40.desc"
	picture = GFX_evt_intelligence_report
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "INTRIGUING"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Plexi Digsite Stage 6
fleet_event = {
	id = AAA_precursor.41
	title = "AAA_precursor.41.name"
	desc = "AAA_precursor.41.desc"
	picture = GFX_evt_intelligence_report
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "ancrel.2024.a"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				add_relic = r_plexi_log
				set_country_flag = AAA_plexi_chain_finished
				large_artifact_reward = yes
				hidden_effect = {
					set_variable = {
						which = plexi_log_usage
						value = 7
					}
					set_variable = {
						which = plexi_log_date_obtained
						value = trigger:years_passed
					}
				}
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 9999
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			add_monthly_resource_mult = {
				resource = energy
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
		}
	}
}

# Plexi Artifact Research Complete
country_event = {
	id = AAA_precursor.42
	title = AAA_precursor.42.name
	desc = {
		trigger = { has_technology = tech_command_matrix }
		text = AAA_precursor.42.desc.matrix
	}
	desc = {
		trigger = {
			NOT = { has_technology = tech_command_matrix }
		}
		text = AAA_precursor.42.desc.tomb
	}

	picture = GFX_evt_fleet_evil
	location = from

	is_triggered_only = yes

	option = {
		exclusive_trigger = {
			NOT = { has_technology = tech_command_matrix }
		}

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_military_theory }
				}
				add_trait = { trait = leader_trait_expertise_military_theory }
			}
			else = {
				add_experience = 200
			}
		}

		name = INTERESTING
		owner = {
			give_technology = { tech = tech_command_matrix }
			add_tech_progress = {
				tech = tech_secrets_plexian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_plexi_research_completed # strike craft attack speed
			days = -1
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				has_technology = tech_command_matrix
				NOT = { has_technology = tech_tomb_world_adaption }
			}
		}

		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_military_theory }
				}
				add_trait = { trait = leader_trait_expertise_military_theory }
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			give_technology = { tech = tech_tomb_world_adaption }
			add_tech_progress = {
				tech = tech_secrets_plexian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_plexi_research_completed # strike craft attack speed
			days = -1
		}
	}

	option = {
		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_military_theory }
				}
				add_trait = { trait = leader_trait_expertise_military_theory }
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			add_tech_progress = {
				tech = tech_secrets_plexian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_plexi_research_completed # strike craft attack speed
			days = -1
		}
	}
}

###########################################
# "THE SEARCH FOR LARTIA" by Metallichydra
###########################################

####################################
# "Crashed Ship"
####################################

# Lartia Introduction
# via on_survey = {} | this = surveying vessel
ship_event = {
    id = AAA_precursor.51
    title = "AAA_precursor.51.name"
    desc = "AAA_precursor.51.desc"
    picture = GFX_evt_crashed_station
    show_sound = event_default
    location = from

    fire_only_once = yes

    is_triggered_only = yes

    trigger = {
        owner = { scfe_can_find_precursor = yes }
        OR = {
            AND = {
                NOT = { has_global_flag = Precursor_Selection_installed }
                owner = {
                    is_ai = no
                    has_precursor_intro = no
                }
            }
            AND = {
                has_global_flag = Precursor_Selection_installed
                owner = {
                    is_ai = no
                    NOT = { has_country_flag = lartia_intro }
                    has_country_flag = picked_lartia
                }
            }
        }
        solar_system = {
            has_star_flag = precursor_lartia
            NOR = {
                is_same_value = root.owner.capital_scope.solar_system
                has_star_flag = sol_system
            }
        }
        NOT = { has_global_flag = lartia_started }
        FROM = {
            has_anomaly = no
            is_star = no
            NOT = { exists = archaeological_site }
            NOT = { has_planet_flag = suppress_archaeological_sites }
            NOR = {
                is_planet_class = pc_gas_giant
                is_planet_class = pc_molten
                is_planet_class = pc_toxic
                is_planet_class = pc_shattered
            }
        }
    }
    weight_multiplier = {
        factor = 1
        modifier = {
            factor = @origin_shoulders_multiplier
            owner = {
                has_origin = origin_shoulders_of_giants
                has_country_flag = origin_shoulders_closure
            }
        }
        modifier = {
            factor = 1000
            owner = {
                has_country_flag = picked_lartia
            }
        }
        modifier = {
            factor = 0
            owner = {
                has_country_flag = PreSelect_Recent_Discovery
            }
        }
    }

    immediate = {
        set_global_flag = lartia_started
        owner = { set_country_flag = lartia_intro }
        owner = { set_timed_country_flag = { flag = PreSelect_Recent_Discovery days = 180 } }
        if = {
            limit = {
                has_PreSelect_active = no
            }
            owner = { set_country_flag = vultaum_intro }
        }
        solar_system = { set_star_flag = first_lartia_site@root.owner }
    }

    option = {
        name = CURIOUS
        hidden_effect = {
            owner = { country_event = { id = story.5 days = 30 } }
            from = { create_archaeological_site = lartia_digsite_1 }
        }
    }
}

# Lartia Digsite Stage 1
fleet_event = {
    id = AAA_precursor.52
    #archaeology_window = yes
    title = "AAA_precursor.52.name"
    desc = "AAA_precursor.52.desc"
    picture = GFX_evt_gunrunning
    show_sound = event_finding_loot
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 2
fleet_event = {
    id = AAA_precursor.53
    #archaeology_window = yes
    title = "AAA_precursor.53.name"
    desc = "AAA_precursor.53.desc"
    picture = GFX_evt_clocks
    show_sound = event_finding_loot
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 3
fleet_event = {
    id = AAA_precursor.54
    title = "AAA_precursor.54.name"
    desc = "AAA_precursor.54.desc"
    picture = GFX_evt_star_chart
    show_sound = event_finding_loot
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
        if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
    }

    option = {
        name = "ancrel.2024.a"
        medium_artifact_reward = yes
        ROOT = {
            hidden_effect = {
                fleet_event = { id = AAA_precursor.55 days = 10 } #Spawns 2nd Lartia Digsite
            }
        }
    }
}

# Spawn 2nd Lartia Digsite
fleet_event = {
    id = AAA_precursor.55
    title = "AAA_precursor.55.name"
    desc = AAA_precursor.55.desc
    picture = GFX_evt_star_chart
    show_sound = event_finding_loot
    location = event_target:new_lartia_digsite

    #archaeology = yes

    is_triggered_only = yes

    immediate = {
        closest_system = {
            limit = {
                has_access_fleet = root.owner
                is_capital_system = no
                NOR = {
                    is_same_value = root.solar_system
                    has_star_flag = first_lartia_site@root.owner
                    is_same_value = root.owner.capital_scope.solar_system
                    has_star_flag = hostile_system
                }
                is_fe_cluster = no
                OR = {
                    has_owner = no
                    owner = { is_same_value = root.owner }
                }
                any_system_planet = {
                    is_star = no
                    habitable_planet = no
                    has_anomaly = no
                    NOR = {
                        exists = archaeological_site
                        has_planet_flag = suppress_archaeological_sites #for modders
                    }
                }
                root.owner = {
                    any_controlled_fleet = {
                        is_ship_class = shipclass_science_ship
                        can_access_system = prevprev
                    }
                }
            }
            min_steps = 3
            max_steps = 15
            root.owner = { set_visited = prev }
            random_system_planet = {
                limit = {
                    is_star = no
                    habitable_planet = no
                    has_anomaly = no
                    NOR = {
                        exists = archaeological_site
                        has_planet_flag = suppress_archaeological_sites
                    }
                }
                create_archaeological_site = lartia_digsite_2
                root.owner = {
                    set_country_flag = lartia_arc_chain_@prev
                }
                #add_deposit = d_zro_deposit_3
                save_event_target_as = new_lartia_digsite
            }
        }
        if = {
            limit = {
                NOT = { exists = event_target:new_lartia_digsite }
            }
            closest_system = {
                limit = {
                    has_access_fleet = root.owner
                    is_capital_system = no
                    NOR = {
                        is_same_value = root.solar_system
                        has_star_flag = first_lartia_site@root.owner
                        is_same_value = root.owner.capital_scope.solar_system
                        has_star_flag = hostile_system
                    }
                    is_fe_cluster = no
                    OR = {
                        has_owner = no
                        owner = { is_same_value = root.owner }
                    }
                    any_system_planet = {
                        OR = {
                            is_planet_class = pc_barren
                            is_planet_class = pc_barren_cold
                        }
                        has_anomaly = no
                        NOR = {
                            exists = archaeological_site
                            has_planet_flag = hatchling_egg
                            has_planet_flag = suppress_archaeological_sites
                        }
                    }
                }
                min_steps = 1
                root.owner = { set_visited = prev }
                random_system_planet = {
                    limit = {
                        OR = {
                            is_planet_class = pc_barren
                            is_planet_class = pc_barren_cold
                        }
                        has_anomaly = no
                        NOR = {
                            exists = archaeological_site
                            has_planet_flag = hatchling_egg
                            has_planet_flag = suppress_archaeological_sites
                        }
                    }
                    create_archaeological_site = lartia_digsite_2
                    root.owner = {
                        set_country_flag = lartia_arc_chain_@prev
                    }
                    #add_deposit = d_zro_deposit_3
                    save_event_target_as = new_lartia_digsite
                }
            }
        }
    }

    option = {
        name = SET_SAIL_LARTIA
        small_artifact_reward = yes
    }
}

####################################
# "Ship Debris"
####################################

# Lartia Digsite Stage 1
fleet_event = {
    id = AAA_precursor.56
    #archaeology_window = yes
    title = "AAA_precursor.56.name"
    desc = "AAA_precursor.56.desc"
    picture = GFX_evt_debris
    show_sound = event_finding_loot
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 2
fleet_event = {
    id = AAA_precursor.57
    #archaeology_window = yes
    title = "AAA_precursor.57.name"
    desc = "AAA_precursor.57.desc"
    picture = GFX_evt_debris
    show_sound = event_ship_explosion
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 3
fleet_event = {
    id = AAA_precursor.58
    title = "AAA_precursor.58.name"
    desc = "AAA_precursor.58.desc"
    picture = GFX_evt_glitchy_matrix
    show_sound = event_ship_bridge
    location = from

    archaeology = yes

    specimen = AAA_lartian_database

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
        if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
    }

    option = {
        name = "CURIOUS"
        owner = {
            country_event = { id = AAA_precursor.59 days = 1 }
        }
    }
}

# Computer Database
country_event = {
    id = AAA_precursor.59
    title = "AAA_precursor.59.name"
    desc = "AAA_precursor.59.desc"
    location = this
    diplomatic_title = BLANK_STRING

    diplomatic = yes

    is_triggered_only = yes

    picture_event_data = {
        room = no_video_feed_room
    }

    option = {
        name = "AAA_precursor.59.a"
        response_text = "AAA_precursor.59.a.response"
        is_dialog_only = yes
    }
    option = {
        name = "AAA_precursor.59.b"
        response_text = "AAA_precursor.59.b.response"
        is_dialog_only = yes
    }
    option = {
        name = "AAA_precursor.59.c"
        response_text = "AAA_precursor.59.c.response"
        is_dialog_only = yes
    }
    option = {
        name = "AAA_precursor.59.d"
        trigger = {
            OR = {
                has_ethic = ethic_fanatic_materialist
                has_ethic = ethic_materialist
                has_country_flag = synthetic_empire
                has_authority = auth_machine_intelligence
            }
        }
        response_text = "AAA_precursor.59.d.response"
        is_dialog_only = yes
    }
    option = {
        name = "AAA_precursor.59.e"
        trigger = {
            OR = {
                has_ethic = ethic_fanatic_materialist
                has_ethic = ethic_materialist
                has_authority = auth_machine_intelligence
            }
        }
        response_text = "AAA_precursor.59.e.response"
        is_dialog_only = yes
    }
    option = {
        name = "AAA_precursor.59.f"
        trigger = {
            OR = {
                has_ethic = ethic_fanatic_materialist
                has_authority = auth_machine_intelligence
            }
        }
        response_text = "AAA_precursor.59.f.response"
        is_dialog_only = yes
    }
    option = {
        name = "AAA_precursor.59.g"
        trigger = {
            NOR = {
                has_authority = auth_machine_intelligence
            }
        }
        owner = {
            hidden_effect = { country_event = { id = AAA_precursor.60 days = 1 } }
        }
    }
    option = {
        name = "AAA_precursor.59.h"
        trigger = {
            OR = {
                has_authority = auth_machine_intelligence
                has_authority = auth_hive_mind
            }
        }
        owner = {
            hidden_effect = { country_event = { id = AAA_precursor.60 days = 1 } }
        }
    }
}

#Lartia battle system(hidden)
country_event = {
    id = AAA_precursor.60
    hide_window = yes

    fire_only_once = yes

    is_triggered_only = yes

    immediate = {
        set_global_flag = lartia_battle_system_discovered
        set_country_flag = lartia_battle_system
        if = {
            limit = {
                any_system_within_border = { has_star_flag = precursor_lartia }
            }
            random_system_within_border = {
                limit = { has_star_flag = precursor_lartia }
                save_event_target_as = lartia_battle_spawn_system
            }
        }
        else = {
            random_system_within_border = {
                save_event_target_as = lartia_battle_spawn_system
            }
        }
        event_target:lartia_battle_spawn_system = {
            spawn_system = {
                min_distance = 10
                max_distance = 30
                max_jumps = 0
                initializer = "lartia_battle_system"
            }
            if = {
                limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
                add_hyperlane = {
                    from = this
                    to = last_created_system
                }
            }
            else = {
                add_extra_hyperlane_to_spawned_system_effect = yes
            }
        }
        country_event = { id = AAA_precursor.61 days = 5 }
    }
}

#Lartia Battle System
country_event = {
    id = AAA_precursor.61
    title = "AAA_precursor.61.name"
    desc = "AAA_precursor.61.desc"
    picture = GFX_evt_star_chart
    location = event_target:lartia_battle_system
    show_sound = event_alien_signal

    is_triggered_only = yes

    immediate = {
        random_system = {
            limit = { has_star_flag = lartia_battle_system }
            save_event_target_as = lartia_battle_system
        }
        # observer_event = { id = observer.85 }
        event_target:lartia_battle_system = {
            random_neighbor_system = {
                save_event_target_as = lartia_battle_neighbor
            }
        }
    }

    option = {
        name = "CURIOUS"
    }
}

####################################
# "Battle System Debris"
####################################

# Lartia Digsite Stage 1
fleet_event = {
    id = AAA_precursor.62
    #archaeology_window = yes
    title = "AAA_precursor.62.name"
    desc = "AAA_precursor.62.desc"
    picture = GFX_evt_sabotaged_ship
    show_sound = event_finding_loot
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 2
fleet_event = {
    id = AAA_precursor.63
    #archaeology_window = yes
    title = "AAA_precursor.63.name"
    desc = "AAA_precursor.63.desc"
    picture = GFX_evt_clocks
    show_sound = event_mystic_reveal
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 3
fleet_event = {
    id = AAA_precursor.64
    title = "AAA_precursor.64.name"
    desc = "AAA_precursor.64.desc"
    picture = GFX_evt_small_space_battle
    show_sound = event_default
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 4
fleet_event = {
    id = AAA_precursor.65
    title = "AAA_precursor.65.name"
    desc = "AAA_precursor.65.desc"
    picture = GFX_evt_mysterious_signal
    show_sound = event_alien_signal
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
    }

    option = {
        name = "CURIOUS"
        owner = {
            if = {
                limit = { has_ancrel = yes }
                small_artifact_reward = yes
            }
        }
    }
}

# Lartia Digsite Stage 5
fleet_event = {
    id = AAA_precursor.66
    title = "AAA_precursor.66.name"
    desc = "AAA_precursor.66.desc"
    picture = GFX_evt_mysterious_signal
    show_sound = event_alien_signal
    location = from

    archaeology = yes

    is_triggered_only = yes

    immediate = {
        from = { set_site_progress_locked = yes }
    }

    after = {
        from = { set_site_progress_locked = no }
        if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
    }

    option = {
        name = "CURIOUS"
        owner = {
            country_event = { id = AAA_precursor.67 days = 1 }
        }
    }
}

#Lartia home system(hidden)
country_event = {
    id = AAA_precursor.67
    hide_window = yes

    fire_only_once = yes

    is_triggered_only = yes

    immediate = {
        set_global_flag = lartia_home_system_discovered
        set_country_flag = lartia_home_system
        if = {
            limit = {
                any_system_within_border = { has_star_flag = precursor_lartia }
            }
            random_system_within_border = {
                limit = { has_star_flag = precursor_lartia }
                save_event_target_as = lartia_home_spawn_system
            }
        }
        else = {
            random_system_within_border = {
                save_event_target_as = lartia_home_spawn_system
            }
        }
        event_target:lartia_home_spawn_system = {
            spawn_system = {
                min_distance = 10
                max_distance = 30
                max_jumps = 0
                initializer = "lartia_system"
            }
            if = {
                limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
                add_hyperlane = {
                    from = this
                    to = last_created_system
                }
            }
            else = {
                add_extra_hyperlane_to_spawned_system_effect = yes
            }
        }
        country_event = { id = AAA_precursor.68 days = 5 }
    }
}

#Lartia Battle System
country_event = {
    id = AAA_precursor.68
    title = "AAA_precursor.68.name"
    desc = "AAA_precursor.68.desc"
    picture = GFX_evt_star_chart
    location = event_target:lartia_home_system
    show_sound = event_finding_loot

    is_triggered_only = yes

    immediate = {
        random_system = {
            limit = { has_star_flag = lartia_home_system }
            save_event_target_as = lartia_home_system
        }
        # observer_event = { id = observer.85 }
        event_target:lartia_home_system = {
            random_neighbor_system = {
                save_event_target_as = lartia_home_neighbor
            }
        }
    }

    option = {
        name = "CURIOUS"
    }
}

# Lartia Artifact Research Complete
country_event = {
    id = AAA_precursor.69
    title = AAA_precursor.69.name
    desc = {
        trigger = { has_technology = tech_encryption_3 }
        text = AAA_precursor.69.desc.negative
    }
    desc = {
        trigger = {
            NOT = { has_technology = tech_encryption_3 }
        }
        text = AAA_precursor.69.desc.positive
    }

    picture = GFX_evt_clocks
    location = from

    is_triggered_only = yes

    option = {
        exclusive_trigger = {
            NOT = { has_technology = tech_encryption_3 }
        }

        random_owned_leader = {
            limit = {
                OR = {
                    is_councilor_type = councilor_research
                    is_councilor_type = councilor_gestalt_cognitive
                }
            }

            if = {
                limit = {
                    NOT = { has_trait = leader_trait_expertise_field_manipulation }
                }
                add_trait = { trait = leader_trait_expertise_field_manipulation }
            }
            else = {
                add_experience = 200
            }
        }

        name = INTERESTING
        owner = {
            give_technology = { tech = tech_encryption_3 }
            add_tech_progress = {
                tech = tech_secrets_lartian
                progress = 0.1
            }
        }
        add_modifier = {
            modifier = artifact_lartia_research_completed # strike craft attack speed
            days = -1
        }
    }

    option = {
        exclusive_trigger = {
            owner = {
                has_technology = tech_encryption_3
                NOT = { has_technology = tech_tomb_world_adaption }
            }
        }

        name = INTERESTING

        random_owned_leader = {
            limit = {
                OR = {
                    is_councilor_type = councilor_research
                    is_councilor_type = councilor_gestalt_cognitive
                }
            }

            if = {
                limit = {
                    NOT = { has_trait = leader_trait_expertise_field_manipulation }
                }
                add_trait = { trait = leader_trait_expertise_field_manipulation }
            }
            else = {
                add_experience = 200
            }
        }

        owner = {
            give_technology = { tech = tech_tomb_world_adaption }
            add_tech_progress = {
                tech = tech_secrets_lartian
                progress = 0.1
            }
        }
        add_modifier = {
            modifier = artifact_lartia_research_completed # strike craft attack speed
            days = -1
        }
    }

    option = {
        name = INTERESTING

        random_owned_leader = {
            limit = {
                OR = {
                    is_councilor_type = councilor_research
                    is_councilor_type = councilor_gestalt_cognitive
                }
            }

            if = {
                limit = {
                    NOT = { has_trait = leader_trait_expertise_field_manipulation }
                }
                add_trait = { trait = leader_trait_expertise_field_manipulation }
            }
            else = {
                add_experience = 200
            }
        }

        owner = {
            add_monthly_resource_mult = {
                resource = physics_research
                value = @tier4researchreward
                min = @tier4researchmin
                max = @tier4researchmax
            }
            add_tech_progress = {
                tech = tech_secrets_lartian
                progress = 0.1
            }
        }
        add_modifier = {
            modifier = artifact_lartia_research_completed # strike craft attack speed
            days = -1
        }
    }
}
